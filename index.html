<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>The encryption game</title>

    <!-- MathJax para LaTeX -->
  <script>
    window.MathJax = {
      tex: {
        inlineMath: [['$', '$'], ['\\(', '\\)']],
        displayMath: [['$$', '$$'], ['\\[', '\\]']]
      },
      svg: {
        fontCache: 'global'
      }
    };
  </script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/3.2.2/es5/tex-mml-chtml.min.js"></script>


  <style>
    body {
      font-family: sans-serif;
      max-width: 600px;
      margin: 50px auto;
    }

    input {
      width: 100%;
      padding: 10px;
      font-size: 1.2em;
    }

    li {
      margin-top: 10px;
      font-size: 1.1em;
    }

    .ok { color: green; }
    .fail { color: red; }
    .oculto { display: none; }
  </style>

</head>
<body>
  <h1>The # encryption # game</h1>

  <h2> Para seguir cifrando por favor agregar un '#' </h2>

  <input type="text" id="password" placeholder="Escribe tu contraseña aquí">

  <ul id="reglas-container">
    <!-- Las reglas se generarán dinámicamente -->
  </ul>

  <div id="victoria" style="display: none;">
    <h1>¡Ganaste!</h1>
    <p>Has completado todas las reglas correctamente</p>
  </div>

  <script>
    // Función para generar números aleatorios
    function aleatorioEntre(min, max) {
      return Math.floor(Math.random() * (max - min + 1)) + min;
    }

    // Generadores de preguntas aleatorias
    function pregunta1() {
      const numero1 = aleatorioEntre(1, 10);
      const numero2 = aleatorioEntre(1, 10);
      const respuesta = numero1 + numero2;
      return {
        texto: `Regla 1: La encriptación debe incluir el número ${numero1} + ${numero2}`,
        respuesta: respuesta.toString()
      };
    }

    function pregunta2() {
      const numero1 = aleatorioEntre(1, 10);
      const numero2 = aleatorioEntre(1, 10);
      const respuesta = numero1 - numero2;
      return {
        texto: `Regla 2: La encriptación debe incluir el número ${numero1} - ${numero2}`,
        respuesta: respuesta.toString()
      };
    }

    function pregunta3() {
      const numero1 = aleatorioEntre(100000, 500000);
      const numero2 = aleatorioEntre(100000, 500000);
      const respuesta = numero1 + numero2;
      return {
        texto: `Regla 3: La encriptación debe incluir el número ${numero1.toLocaleString()} + ${numero2.toLocaleString()}`,
        respuesta: respuesta.toString()
      };
    }

    function pregunta4() {
      const numero1 = aleatorioEntre(100000, 500000);
      const numero2 = aleatorioEntre(100000, 500000);
      const respuesta = numero1 - numero2;
      return {
        texto: `Regla 4: La encriptación debe incluir el número ${numero1.toLocaleString()} - ${numero2.toLocaleString()}`,
        respuesta: respuesta.toString()
      };
    }

    function pregunta5() {
      const numero1 = aleatorioEntre(2, 10);
      const numero2 = aleatorioEntre(2, 10);
      const respuesta = numero1 * numero2;
      return {
        texto: `Regla 5: La encriptación debe incluir el número ${numero1} x ${numero2}`,
        respuesta: respuesta.toString()
      };
    }

    function pregunta6() {
      const numero1 = aleatorioEntre(10, 20);
      const numero2 = aleatorioEntre(-20, -10);
      const respuesta = numero1 * numero2;
      return {
        texto: `Regla 6: La encriptación debe incluir el número ${numero1} x ${numero2}`,
        respuesta: respuesta.toString()
      };
    }

    function pregunta7() {
      const numero1 = aleatorioEntre(100, 999);
      const numero2 = aleatorioEntre(-999, -100);
      const respuesta = numero1 * numero2;
      return {
        texto: `Regla 7: La encriptación debe incluir el número ${numero1} x ${numero2}`,
        respuesta: respuesta.toString()
      };
    }

    function pregunta8() {
      const numero1 = aleatorioEntre(100, 999);
      const numero2 = aleatorioEntre(100, 999);
      const numero3 = aleatorioEntre(1000, 9999);
      const respuesta = numero1 * numero2 + numero3;
      return {
        texto: `Regla 8: La encriptación debe incluir el número ${numero1} x ${numero2} + ${numero3}`,
        respuesta: respuesta.toString()
      };
    }

    function pregunta9() {
      const numero1 = aleatorioEntre(10, 100);
      const numero2 = aleatorioEntre(2, 10);
      // Asegurar división exacta
      const numeroAjustado = numero1 - (numero1 % numero2);
      const respuesta = numeroAjustado / numero2;
      return {
        texto: `Regla 9: La encriptación debe incluir el número ${numeroAjustado} ÷ ${numero2}`,
        respuesta: respuesta.toString()
      };
    }

    function pregunta10() {
      const numero2 = 10;
      const numero1 = numero2 * aleatorioEntre(10, 100);
      const respuesta = numero1 / numero2;
      return {
        texto: `Regla 10: La encriptación debe incluir el número ${numero1} ÷ ${numero2}`,
        respuesta: respuesta.toString()
      };
    }

    function pregunta11() {
      const numero2 = aleatorioEntre(10, 20);
      const numero1 = numero2 * aleatorioEntre(20, 200);
      const respuesta = numero1 / numero2;
      return {
        texto: `Regla 11: La encriptación debe incluir el número ${numero1} ÷ ${numero2}`,
        respuesta: respuesta.toString()
      };
    }

    function pregunta12() {
      const dividendo = aleatorioEntre(10, 50);
      const divisor = aleatorioEntre(3, 9);
      return {
        texto: `Regla 12: La encriptación debe incluir el número del 'dividendo' de la siguiente división ${dividendo} ÷ ${divisor}`,
        respuesta: dividendo.toString()
      };
    }

    function pregunta13() {
      const dividendo = aleatorioEntre(10, 50);
      const divisor = aleatorioEntre(3, 9);
      return {
        texto: `Regla 13: La encriptación debe incluir el número del 'divisor' de la siguiente división ${dividendo} ÷ ${divisor}`,
        respuesta: divisor.toString()
      };
    }

    function pregunta14() {
      const dividendo = aleatorioEntre(10, 50);
      const divisor = aleatorioEntre(3, 9);
      const cociente = Math.floor(dividendo / divisor);
      return {
        texto: `Regla 14: La encriptación debe incluir el número del 'cociente' de la siguiente división ${dividendo} ÷ ${divisor}`,
        respuesta: cociente.toString()
      };
    }

    function pregunta15() {
      const dividendo = aleatorioEntre(10, 50);
      const divisor = aleatorioEntre(3, 9);
      const residuo = dividendo % divisor;
      return {
        texto: `Regla 15: La encriptación debe incluir el número del 'residuo' de la siguiente división ${dividendo} ÷ ${divisor}`,
        respuesta: residuo.toString()
      };
    }

    function pregunta16() {
      const dividendo = aleatorioEntre(10, 30);
      const divisor = aleatorioEntre(3, 7);
      const cociente = Math.floor(dividendo / divisor);
      const residuo = dividendo % divisor;
      const respuesta = dividendo * divisor * cociente * residuo;
      return {
        texto: `Regla 16: La encriptación debe incluir el número dado por el resultado de multiplicar el dividendo, divisor, cociente y residuo de la siguiente división ${dividendo} ÷ ${divisor}`,
        respuesta: respuesta.toString()
      };
    }

    function pregunta17() {
      const base = 2;
      const exponente = aleatorioEntre(5, 10);
      const respuesta = Math.pow(base, exponente);
      return {
        texto: `Regla 17: La encriptación debe incluir el número $${base}^${exponente}$`,
        respuesta: respuesta.toString()
      };
    }

    function pregunta18() {
      const num1 = aleatorioEntre(3, 7);
      const exp1 = aleatorioEntre(3, 5);
      const num2 = aleatorioEntre(3, 9);
      const exp2 = aleatorioEntre(3, 4);
      const num3 = aleatorioEntre(3, 9);
      const exp3 = aleatorioEntre(3, 4);
      const respuesta = Math.pow(num1, exp1) + Math.pow(num2, exp2) + Math.pow(num3, exp3);
      return {
        texto: `Regla 18: La encriptación debe incluir el número $${num1}^${exp1} + ${num2}^${exp2} + ${num3}^${exp3}$`,
        respuesta: respuesta.toString()
      };
    }

    function pregunta19() {
      const bases = [10, 100, 1000];
      const numero = bases[aleatorioEntre(0, bases.length - 1)];
      const respuesta = Math.log10(numero);
      return {
        texto: `Regla 19: La encriptación debe incluir el número $\\log_{10}(${numero})$`,
        respuesta: respuesta.toString()
      };
    }

    function pregunta20() {
      // Crear logaritmos que den resultados enteros
      const logs = [
        { base: 2, num: 8, res: 3 },
        { base: 3, num: 27, res: 3 },
        { base: 5, num: 125, res: 3 },
        { base: 2, num: 16, res: 4 }
      ];
      const log1 = logs[aleatorioEntre(0, logs.length - 1)];
      const log2 = logs[aleatorioEntre(0, logs.length - 1)];
      const log3 = logs[aleatorioEntre(0, logs.length - 1)];
      const respuesta = log1.res + log2.res + log3.res;
      return {
        texto: `Regla 20: La encriptación debe incluir el número $\\log_{${log1.base}}(${log1.num}) + \\log_{${log2.base}}(${log2.num}) + \\log_{${log3.base}}(${log3.num})$`,
        respuesta: respuesta.toString()
      };

    }
        function pregunta21() {
      const num1 = aleatorioEntre(10,99);
      const num2 = aleatorioEntre(10,99);
      const num4 = aleatorioEntre(1,10);
      const num3 = num4 * aleatorioEntre(10,99);
      const num5 = aleatorioEntre(10,99);
      const num6 = aleatorioEntre(10,99);
      const respuesta = num1 + num2 * num3 / num4 * num5 + num6

      return {
        texto: `Regla 21: La encriptación debe incluir el número ${num1} + ${num2} × ${num3} ÷ ${num4} × ${num5} + ${num6} `, 
        respuesta: respuesta.toString()
      };
    }

    function pregunta22(){
      const num2 = aleatorioEntre(2,9);
      const num1 = num2 * aleatorioEntre(11,50);
      const respuesta = num1 / num2;

      return{
        texto: `Regla 22: La encriptación debe incluir el número $\\frac{${num1}}{${num2}}$`,
        respuesta: respuesta.toString()
      };
    }

    // Generar todas las preguntas al cargar la página
    const reglasConfig = [
      pregunta1(),
      pregunta2(),
      pregunta3(),
      pregunta4(),
      pregunta5(),
      pregunta6(),
      pregunta7(),
      pregunta8(),
      pregunta9(),
      pregunta10(),
      pregunta11(),
      pregunta12(),
      pregunta13(),
      pregunta14(),
      pregunta15(),
      pregunta16(),
      pregunta17(),
      pregunta18(),
      pregunta19(),
      pregunta20(),
      pregunta21(),
      pregunta22()
    ].map(pregunta => ({
      texto: pregunta.texto,
      respuestas: [pregunta.respuesta]
    }));

    // Generar elementos HTML dinámicamente (en orden inverso para efecto pila)
    const container = document.getElementById('reglas-container');
    const reglas = [];
    const desbloqueadas = [];

    // Crear todos los elementos primero
    reglasConfig.forEach((config, index) => {
      const li = document.createElement('li');
      li.id = `regla${index + 1}`;
      li.className = index === 0 ? '' : 'oculto';
      li.textContent = config.texto;
      reglas.push(li);
      desbloqueadas.push(index === 0);
    });

    // Agregar el primer elemento (regla 1) que siempre está visible
    container.appendChild(reglas[0]);

    const input = document.getElementById('password');

    input.addEventListener('input', () => {
      const partes = input.value.split('#').map(p => p.trim());
      let todasCorrectas = true;
      let reglasCompletadas = 0;

      for (let i = 0; i < reglas.length; i++) {
        const regla = reglas[i];
        const respuestas = reglasConfig[i].respuestas;

        if (desbloqueadas[i]) {
          regla.classList.remove('oculto');
          const coincide = partes.some(parte => respuestas.includes(parte));
          if (coincide) {
            regla.className = 'ok';
            reglasCompletadas++;
          } else {
            regla.className = 'fail';
            todasCorrectas = false;
          }
        } else {
          // Solo se desbloquea la siguiente si todas las anteriores están correctas
          if (todasCorrectas) {
            desbloqueadas[i] = true;
            reglas[i].classList.remove('oculto');
            // Insertar la nueva regla al principio de la lista (efecto pila)
            container.insertBefore(reglas[i], container.firstChild);
            
            // Procesar LaTeX en la nueva regla
            if (window.MathJax) {
              MathJax.typesetPromise([reglas[i]]).catch(function (err) {
                console.log('MathJax error:', err.message);
              });
            }
            
            // IMPORTANTE: detenemos aquí para evitar desbloquear más de una por input
            break;
          } else {
            break; // si anteriores están mal, no desbloquees esta ni las siguientes
          }
        }
      }

      // Verificar si se completaron todas las reglas
      if (reglasCompletadas === reglas.length) {
        document.getElementById('victoria').style.display = 'block';
        container.style.display = 'none';
        input.style.display = 'none';
      }
    });

    // Procesar LaTeX inicial cuando MathJax esté listo
    window.addEventListener('load', function() {
      if (window.MathJax) {
        MathJax.typesetPromise([container]).catch(function (err) {
          console.log('MathJax initial error:', err.message);
        });
      }
    });

  </script>
  
</body>
</html>